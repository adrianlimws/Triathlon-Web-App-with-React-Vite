<!DOCTYPE html>
<html>

<head>
    <title>Training Plan App</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useMemo } = React

        function TrainingPlanPage() {
            const [trainingPlan, setTrainingPlan] = useState(null)
            const [workoutType, setWorkoutType] = useState('')
            const [workoutDistance, setWorkoutDistance] = useState('')
            const [workoutDuration, setWorkoutDuration] = useState('')
            const [workoutDate, setWorkoutDate] = useState('')
            const [sortCriteria, setSortCriteria] = useState('date')

            const handleCreatePlan = async () => {
                const { default: TrainingPlan } = await import('./js/models/trainingplan.js')
                const plan = new TrainingPlan()
                plan.createPlan()
                setTrainingPlan(plan)
            }

            const handleAddWorkout = async (e) => {
                e.preventDefault()

                if (!workoutType) {
                    alert('Please select a workout type')
                    return
                }

                const { default: Workout } = await import('./js/models/workout.js')
                const { default: TrainingPlan } = await import('./js/models/trainingplan.js')
                const workout = new Workout(
                    workoutType,
                    parseFloat(workoutDistance),
                    parseInt(workoutDuration),
                    new Date(workoutDate)
                )
                const updatedPlan = new TrainingPlan()
                updatedPlan.allMyWorkout = [...trainingPlan.allMyWorkout, workout]
                setTrainingPlan(updatedPlan)
                setWorkoutType('')
                setWorkoutDistance('')
                setWorkoutDuration('')
                setWorkoutDate('')
            }

            const handleSortChange = (e) => {
                setSortCriteria(e.target.value)
            }

            const sortedWorkouts = useMemo(() => {
                if (!trainingPlan) return []

                const sorted = [...trainingPlan.allMyWorkout]
                switch (sortCriteria) {
                    case 'date':
                        sorted.sort((a, b) => a.date - b.date)
                        break
                    case 'distance':
                        sorted.sort((a, b) => a.distance - b.distance)
                        break
                    case 'duration':
                        sorted.sort((a, b) => a.duration - b.duration)
                        break
                    default:
                        break
                }
                return sorted
            }, [trainingPlan, sortCriteria])

            return (
                <>
                    <h1>Training Plan</h1>
                    {trainingPlan ? (
                        <div>
                            <form onSubmit={handleAddWorkout}>
                                <select
                                    value={workoutType}
                                    onChange={(e) => setWorkoutType(e.target.value)}
                                >
                                    <option value="">Select Workout Type</option>
                                    <option value="running">Running</option>
                                    <option value="swimming">Swimming</option>
                                    <option value="cycling">Cycling</option>
                                </select>
                                <input
                                    type="number"
                                    min="1"
                                    placeholder="Distance (km)"
                                    value={workoutDistance}
                                    onChange={(e) => setWorkoutDistance(e.target.value)}
                                />
                                <input
                                    type="number"
                                    min="1"
                                    placeholder="Duration (minutes)"
                                    value={workoutDuration}
                                    onChange={(e) => setWorkoutDuration(e.target.value)}
                                />
                                <input
                                    type="date"
                                    placeholder="Date"
                                    value={workoutDate}
                                    onChange={(e) => setWorkoutDate(e.target.value)}
                                />
                                <button type="submit">Add Workout</button>
                            </form>
                            <br />
                            <select value={sortCriteria} onChange={handleSortChange}>
                                <option value="date">Date</option>
                                <option value="distance">Distance</option>
                                <option value="duration">Duration</option>
                            </select>
                            <ul>
                                {sortedWorkouts.map((workout, index) => (
                                    <li key={index}>
                                        {workout.type} - {workout.distance}km - {workout.duration} minutes - {workout.date.toLocaleDateString()}
                                    </li>
                                ))}
                            </ul>
                        </div>
                    ) : (
                        <button onClick={handleCreatePlan}>Create Training Plan</button>
                    )}
                </>
            )
        }

        const container = document.getElementById('root')
        const root = ReactDOM.createRoot(container)
        const element = <TrainingPlanPage />
        root.render(element)
    </script>
</body>

</html>